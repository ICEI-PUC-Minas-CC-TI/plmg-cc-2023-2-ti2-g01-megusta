<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/averia" type="text/css">
    <link rel="stylesheet" href="css/estilo.css" />
    <title>Cadastro</title>
  </head>
  <body>
    <header>
      <nav id="nav">
        <a class="logo" href="index.html">ME GUSTA</a>
      </nav>
    </header>
    <div id="section" class="container">
      <div class="card">
        <h1 class="entrarCadastrar">Cadastrar</h1>

        <div id="msgError"></div>
        <div id="msgSuccess"></div>

        <form id="signupForm">
          <div class="label-float">
            <input type="text" id="nome" name="nome" placeholder=" " required />
            <label id="labelNome" for="nome">Nome</label>
          </div>
  
          <div class="label-float">
            <input type="text" id="sobrenome" name="sobrenome" placeholder=" " required />
            <label id="labelSobrenome" for="sobrenome">Sobrenome</label>
          </div>
  
          <div class="label-float">
            <input type="text" id="usuario" name="user" placeholder=" " required />
            <label id="labelUsuario" for="usuario">Usuário</label>
          </div>
  
          <div class="label-float">
            <input type="text" id="email" name="email" placeholder=" " required />
            <label id="labelEmail" for="email">E-mail</label>
          </div>
  
			<div class="label-float">
		  <select id="idade" name="idade" required>
			    <option class="" value="" disabled selected>Idade</option>
			    <option value="10">10</option>
			    <option value="11">11</option>
			    <option value="12">12</option>
			    <option value="13">13</option>
			    <option value="14">14</option>
			    <option value="15">15</option>
			    <option value="16">16</option>
			    <option value="17">17</option>
			    <option value="18">18</option>
			    <option value="19">19</option>
			    <option value="20">20</option>
			    <option value="21">21</option>
			    <option value="22">22</option>
			    <option value="23">23</option>
			    <option value="24">24</option>
			    <option value="25">25</option>
			    <option value="26">26</option>
			    <option value="27">27</option>
			    <option value="28">28</option>
			    <option value="29">29</option>
			    <option value="30">30</option>
			    <option value="31">31</option>
			    <option value="32">32</option>
			    <option value="33">33</option>
			    <option value="34">34</option>
			    <option value="35">35</option>
			    <option value="36">36</option>
			    <option value="37">37</option>
			    <option value="38">38</option>
			    <option value="39">39</option>
			    <option value="40">40</option>
			    <option value="41">41</option>
			    <option value="42">42</option>
			    <option value="43">43</option>
			    <option value="44">44</option>
			    <option value="45">45</option>
			    <option value="46">46</option>
			    <option value="47">47</option>
			    <option value="48">48</option>
			    <option value="49">49</option>
			    <option value="50">50</option>
			    <option value="51">51</option>
			    <option value="52">52</option>
			    <option value="53">53</option>
			    <option value="54">54</option>
			    <option value="55">55</option>
			    <option value="56">56</option>
			    <option value="57">57</option>
			    <option value="58">58</option>
			    <option value="59">59</option>
			    <option value="60">60</option>
				<option value="61">61</option>
				<option value="62">62</option>
				<option value="63">63</option>
				<option value="64">64</option>
				<option value="65">65</option>
				<option value="66">66</option>
				<option value="67">67</option>
				<option value="68">68</option>
				<option value="69">69</option>
				<option value="70">70</option>
				<option value="71">71</option>
				<option value="72">72</option>
				<option value="73">73</option>
				<option value="74">74</option>
				<option value="75">75</option>
				<option value="76">76</option>
				<option value="77">77</option>
				<option value="78">78</option>
				<option value="79">79</option>
				<option value="80">80</option>
				<option value="81">81</option>
				<option value="82">82</option>
				<option value="83">83</option>
				<option value="84">84</option>
				<option value="85">85</option>
				<option value="86">86</option>
				<option value="87">87</option>
				<option value="88">88</option>
				<option value="89">89</option>
				<option value="90">90</option>
				<option value="91">91</option>
				<option value="92">92</option>
				<option value="93">93</option>
				<option value="94">94</option>
				<option value="95">95</option>
				<option value="96">96</option>
				<option value="97">97</option>
				<option value="98">98</option>
			    <option value="99">99</option>
			  </select>
			
			  <select id="genero" name="genero" required>
			    <option value="" disabled selected>Gênero</option>
			    <option value="M">Masculino</option>
			    <option value="F">Feminino</option>
			    <option value="X">Não informar</option>
			  </select>
			</div>

  
          <div class="label-float">
            <input type="password" id="senha" name="senha" placeholder=" " required />
            <label id="labelSenha" for="senha">Senha</label>
          
          </div>
  
          <div class="label-float">
            <input type="password" id="confirmSenha" name="confirmSenha" placeholder=" " required />
            <label id="labelConfirmSenha" for="confirmSenha"
              >Confirmar Senha</label
            >
            
          </div>
  
          <div class="justify-center">
            <button type="submit" id="cadastrar">Cadastrar</button>
          </div>
          <a class="centered" id="cadastro" href="signin.html">Já tenho uma conta</a>
        </form>

      </div>
      
    </div>
    <script src="js/signup.js"></script>
	<script>
	document.addEventListener("DOMContentLoaded", (event) => {
	    let msgError = document.getElementById("msgError");
	    let msgSuccess = document.getElementById("msgSuccess");
	
	    var form = document.getElementById('signupForm');
	    form.addEventListener("submit", function (event) {
	        event.preventDefault();
	
	        const inserirUsuarioURL = 'http://localhost:6789/usuario/insert';
	
	        // Construir manualmente uma string com os dados do formulário
	        const formData = new URLSearchParams(new FormData(form));
	
	        // Adicione os dados do formulário como parâmetros de consulta à URL
	        const urlComParametros = `${inserirUsuarioURL}?${formData}`;
	
	        // Requisição POST para inserir o usuário
	        fetch(urlComParametros, {
	            method: 'POST',
	        })
	        .then(response => response.json())
	        .then(data => {
	            console.log(data);
	            if (data.success) {
	                msgSuccess.style.display = 'block';
	                msgSuccess.innerHTML = '<strong>Usuário inserido com sucesso!</strong>';
	                msgError.style.display = 'none';
	                msgError.innerHTML = '';

	                // Se a inserção for bem-sucedida, redirecionar para a página de login.
	                setTimeout(() => {
	                    window.location.href = 'signin.html';
	                }, 1000);
	                
	                // Limpar os campos do formulário
	                form.reset();
	            } else {
	                if (data.userExists) {
	                    msgError.style.display = 'block';
	                    msgError.innerHTML = '<strong>Nome de usuário já em uso.</strong>';
	                    msgSuccess.innerHTML = '';
	                    msgSuccess.style.display = 'none';
	                } else {
	                    msgError.style.display = 'block';
	                    msgError.innerHTML = '<strong>Falha ao cadastrar usuário. Verifique os dados e tente novamente.</strong>';
	                    msgSuccess.innerHTML = '';
	                    msgSuccess.style.display = 'none';
	                }
	            }
	        })
	        .catch(error => {
	            console.error('Erro durante a solicitação POST:', error);
	        });
	    });
	});
	</script>
  </body>
</html>