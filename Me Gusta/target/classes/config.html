<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/averia" type="text/css">
    <link rel="stylesheet" href="css/estilo.css" />
    <title>Configurações</title>
  </head>
  
  <body>
    <header>
      <nav id="nav">
        <a class="logo" href="index.html">ME GUSTA</a>
      </nav>
    </header>
    <div id="section" class="container">
      <div class="card">
        <h1 class="entrarCadastrar">Configurações</h1>
		<div id="msgSuccess"></div>
		<div id="divTarefas">
			<div id="editarPerfil">
				<a class="a1" onclick="editarPerfil()"><h3>Editar perfil</h3></a>
			</div>	
			<div id="selecionados">
				<a class="a1" onclick="ingSelecionados()"><h3>Ingredientes Selecionados</h3></a>
			</div>
			<div id="banidos">
				<a class="a1" onclick="ingBanidos()"><h3>Ingredientes Banidos</h3></a>
			</div>			
			<div id="abrirMinhasReceitas">
				<a class="a1" onclick="receitasSalvas()"><h3>Receitas salvas</h3></a>
			</div>			
			<div id="gerenciamento">
				<a class="a1" href="gerenciamento.html"><h3>Menu de gerenciamento</h3></a>
			</div>			
			<div id="sair">
				<a class="a1" onclick="sair()"><h3>Sair</h3></a>
			</div>			
		</div>
		
		<div id="botoes">
            <button id="voltar" onclick="redirectToProfile()">
    			Voltar
			</button>
        </div>
      </div>
    </div>
    
    <!-- MODAIS -->
    	<div class="modal" id="myModal5">
		<div id="contentModal4" class="model-content8">
		<div class="food">
        <h1 class="entrarCadastrar">Alimentos de sua preferência</h1>
        
		<form id="meusIngredientes">

        <div id="alimentos">


        </div>
		<div id="mantemID">
				<input type="text" id="user" name="user" placeholder="" value="">
		</div>	
        <div class="justify-center">
            <button id="fecharFood">Fechar</button>
        </div>
     </form>
        <div class="justify-center">
          <hr />
        </div>
      </div>
		</div>
		</div>
		
		    	<div class="modal" id="myModal6">
		<div id="contentModal6" class="model-content8">
		<div class="food">
        <h1 class="entrarCadastrar">Alimentos banidos</h1>
        
		<form id="meusIngredientes">

        <div id="alimentosX">


        </div>
		<div id="mantemID">
				<input type="text" id="user" name="user" placeholder="" value="">
		</div>	
        <div class="justify-center">
            <button id="fecharFoodX">Fechar</button>
        </div>
     </form>
        <div class="justify-center">
          <hr />
        </div>
      </div>
		</div>
		</div>

       <div class="modal" id="myModal3">
			<div id="contentModal3" class="model-content3">
			<h1 class="entrarCadastrar">Editar perfil</h1>
				
		        <div id="msgError4"></div>
		        <div id="msgSuccess4"></div>
		
		        <form id="updateForm">
				<div id="mantemID">
					<input type="text" id="id" name="id" placeholder="" value="" required />
				 </div>
				
		          <div class="label-float">
		            <input type="text" id="nome" name="nome" placeholder="" required />
		            <label id="labelNome" for="nome">Nome</label>
		          </div>
		  
		          <div class="label-float">
		            <input type="text" id="sobrenome" name="sobrenome" placeholder=""  required />
		            <label id="labelSobrenome" for="sobrenome">Sobrenome</label>
		          </div>
		  
		          <div class="label-float">
		            <input type="text" id="usuario" name="user" placeholder=""  required />
		            <label id="labelUsuario" for="usuario">Usuário</label>
		          </div>
		  
		          <div class="label-float">
		            <input type="text" id="email" name="email" placeholder=""  required />
		            <label id="labelEmail" for="email">E-mail</label>
		          </div>
		  
					<div class="label-float">
		  		<select id="idade" name="idade" required>
			    <option class="" value="" disabled selected>Idade</option>
			    <option value="10">10</option>
			    <option value="11">11</option>
			    <option value="12">12</option>
			    <option value="13">13</option>
			    <option value="14">14</option>
			    <option value="15">15</option>
			    <option value="16">16</option>
			    <option value="17">17</option>
			    <option value="18">18</option>
			    <option value="19">19</option>
			    <option value="20">20</option>
			    <option value="21">21</option>
			    <option value="22">22</option>
			    <option value="23">23</option>
			    <option value="24">24</option>
			    <option value="25">25</option>
			    <option value="26">26</option>
			    <option value="27">27</option>
			    <option value="28">28</option>
			    <option value="29">29</option>
			    <option value="30">30</option>
			    <option value="31">31</option>
			    <option value="32">32</option>
			    <option value="33">33</option>
			    <option value="34">34</option>
			    <option value="35">35</option>
			    <option value="36">36</option>
			    <option value="37">37</option>
			    <option value="38">38</option>
			    <option value="39">39</option>
			    <option value="40">40</option>
			    <option value="41">41</option>
			    <option value="42">42</option>
			    <option value="43">43</option>
			    <option value="44">44</option>
			    <option value="45">45</option>
			    <option value="46">46</option>
			    <option value="47">47</option>
			    <option value="48">48</option>
			    <option value="49">49</option>
			    <option value="50">50</option>
			    <option value="51">51</option>
			    <option value="52">52</option>
			    <option value="53">53</option>
			    <option value="54">54</option>
			    <option value="55">55</option>
			    <option value="56">56</option>
			    <option value="57">57</option>
			    <option value="58">58</option>
			    <option value="59">59</option>
			    <option value="60">60</option>
				<option value="61">61</option>
				<option value="62">62</option>
				<option value="63">63</option>
				<option value="64">64</option>
				<option value="65">65</option>
				<option value="66">66</option>
				<option value="67">67</option>
				<option value="68">68</option>
				<option value="69">69</option>
				<option value="70">70</option>
				<option value="71">71</option>
				<option value="72">72</option>
				<option value="73">73</option>
				<option value="74">74</option>
				<option value="75">75</option>
				<option value="76">76</option>
				<option value="77">77</option>
				<option value="78">78</option>
				<option value="79">79</option>
				<option value="80">80</option>
				<option value="81">81</option>
				<option value="82">82</option>
				<option value="83">83</option>
				<option value="84">84</option>
				<option value="85">85</option>
				<option value="86">86</option>
				<option value="87">87</option>
				<option value="88">88</option>
				<option value="89">89</option>
				<option value="90">90</option>
				<option value="91">91</option>
				<option value="92">92</option>
				<option value="93">93</option>
				<option value="94">94</option>
				<option value="95">95</option>
				<option value="96">96</option>
				<option value="97">97</option>
				<option value="98">98</option>
			    <option value="99">99</option>
			  </select>
					
					  <select id="genero" name="genero" required>
					    <option value="" disabled selected>Gênero</option>
					    <option value="M">Masculino</option>
					    <option value="F">Feminino</option>
					    <option value="X">Não informar</option>
					  </select>
					</div>
		
				 <div class="label-float">
		            <input type="password" id="senhaAtual" name="senhaAtual" placeholder=" " required />
		            <label id="labelSenhaAtual" for="senhaAtual">Senha atual</label>
		            
		          </div>
		  
		          <div class="label-float">
		            <input type="password" id="senha" name="senha" placeholder=" " required />
		            <label id="labelSenha" for="senha">Senha</label>
		            
		          </div>
		  
		          <div class="label-float">
		            <input type="password" id="confirmSenha" name="confirmSenha" placeholder=" " required />
		            <label id="labelConfirmSenha" for="confirmSenha"
		              >Confirmar Senha</label>
		          </div>
		  
		          <div class="justify-center">
		            <button type="submit" id="alterar">Alterar</button>
		            <button id="fecharModal3">Cancelar</button>
		          </div>
					
		        </form>
		     </div>
        </div>
	
	<script src="js/signup.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			var userString = sessionStorage.getItem('user');
			var user = JSON.parse(userString);
			document.getElementById('id').value = user.id;
		    document.getElementById('user').value = user.id;
			const gerenciamento = document.getElementById("gerenciamento");
			const editarPerfil = document.getElementById("editarPerfil");
			var userString = sessionStorage.getItem('user');
			var user = JSON.parse(userString);
			if(user.permissao != 'S'){
				gerenciamento.style.display = 'none';
			} else {
				editarPerfil.style.display = 'none';
			}
		    
	        let msgError5 = document.getElementById("msgError5");
	    	let msgSuccess5 = document.getElementById("msgSuccess5");
		 });
		
		function redirectToProfile() {
			var userString = sessionStorage.getItem('user');
			var user = JSON.parse(userString);
			
		      setTimeout(() => {
		        window.location.href = `perfil.html?id=${user.id}`;
		      }, 1000);
		   
    	}
    	
		function editarPerfil(){
			const modal = document.getElementById("myModal3");
			modal.style.display = 'block';
			const fecharModal = document.getElementById("fecharModal3");
			
			if(fecharModal){
				fecharModal.addEventListener("click", function(event) {
					event.preventDefault();
	 				modal.style.display = "none";
			    })
			}
			
			const updateForm = document.getElementById("updateForm");
			console.log(updateForm);
			if(updateForm){
				updateForm.addEventListener("submit", function (){
				event.preventDefault();
				
				const updateURL = 'http://localhost:6789/usuario/update';
		
		        // Construir manualmente uma string com os dados do formulário
		        const formData = new URLSearchParams(new FormData(updateForm));
		
		        // Adicione os dados do formulário como parâmetros de consulta à URL
		        const urlComParametros = `${updateURL}?${formData}`;
				
		        // Requisição POST para inserir o usuário
		        fetch(urlComParametros, {
		            method: 'POST',
		        })
		        .then(response => response.json())
		        .then(data => {
		            console.log(data);
		            if (data.success) {
		                msgSuccess4.style.display = 'block';
		                msgSuccess4.innerHTML = '<strong>Perfil alterado com sucesso!</strong>';
		                msgError4.style.display = 'none';
		                msgError4.innerHTML = '';
					sessionStorage.removeItem('username');
			msgSuccess.style.display = 'block';
	        msgSuccess.innerHTML = '<strong>Até mais, espero te ver de novo!</strong>';
			setTimeout(() => {
		        window.location.href = `signin.html`;
		    }, 1000);
		            } else {
	                    msgError4.style.display = 'block';
	                    msgError4.innerHTML = '<strong>Erro ao editar perfil.</strong>';
	                    msgSuccess4.innerHTML = '';
	                    msgSuccess4.style.display = 'none';
	                }
		            
		        })
		        .catch(error => {
		            console.error('Erro durante a solicitação POST:', error);
		        });
				
			});
			}
		}
		
		function receitasSalvas(){
			var userString = sessionStorage.getItem('user');
			var user = JSON.parse(userString);
			
			setTimeout(() => {
		        window.location.href = `receitasSalvas.html?id=${user.id}`;
		    }, 1000);	
		}
		
		function ingSelecionados(){
			var userString = sessionStorage.getItem('user');
			var user = JSON.parse(userString);
			const user_id = user.id;
			const modal = document.getElementById("myModal5");
			modal.style.display = 'block';
			const fecharFood = document.getElementById("fecharFood");
			
			if(fecharFood){
				fecharFood.addEventListener("click", function(event) {
					event.preventDefault();
	 				modal.style.display = "none";
			    })
			}
		        fetch(`http://localhost:6789/ingrediente/selecionados?id=${user_id}`)
		            .then(response => response.json())
		            .then(data => {
		                const mostrarIngredientes = document.getElementById("alimentos");
		                mostrarIngredientes.innerHTML = "";
						console.log(data);
		                if (data) {
		                    data.forEach(ingrediente => {
		                        const divIngrediente = document.createElement('div');
		                        divIngrediente.id = ingrediente.id;
		
		                        const h2Ingrediente = document.createElement('h2');
		                        h2Ingrediente.textContent = ingrediente.nome;
		
		                        divIngrediente.appendChild(h2Ingrediente);
		                        mostrarIngredientes.appendChild(divIngrediente);

		                        divIngrediente.style.backgroundImage = `url('${ingrediente.imagem}')`;
		                    });
		                } else {
		                    console.error('Resposta inválida. A propriedade "ingrediente" está ausente.');
		                }
		            })
		            .catch(error => console.error('Erro ao obter ingredientes:', error));	
		}
		
		function ingBanidos(){
			var userString = sessionStorage.getItem('user');
			var user = JSON.parse(userString);
			const user_id = user.id;
			const modal = document.getElementById("myModal6");
			modal.style.display = 'block';
			const fecharFood = document.getElementById("fecharFoodX");
			
			if(fecharFood){
				fecharFood.addEventListener("click", function(event) {
					event.preventDefault();
	 				modal.style.display = "none";
			    })
			}
		        fetch(`http://localhost:6789/ingrediente/banidos?id=${user_id}`)
		            .then(response => response.json())
		            .then(data => {
		                const mostrarIngrediente = document.getElementById("alimentosX");
		                mostrarIngrediente.innerHTML = "";
						console.log(data);
		                if (data) {
		                    data.forEach(ingrediente => {
		                        const divIngrediente = document.createElement('div');
		                        divIngrediente.id = ingrediente.id;
		
		                        const h2Ingrediente = document.createElement('h2');
		                        h2Ingrediente.textContent = ingrediente.nome;
		
		                        divIngrediente.appendChild(h2Ingrediente);
		                        mostrarIngrediente.appendChild(divIngrediente);

		                        divIngrediente.style.backgroundImage = `url('${ingrediente.imagem}')`;
		                    });
		                } else {
		                    console.error('Resposta inválida. A propriedade "ingrediente" está ausente.');
		                }
		            })
		            .catch(error => console.error('Erro ao obter ingredientes:', error));	
		}
    	
    	function sair(){
			sessionStorage.removeItem('username');
			msgSuccess.style.display = 'block';
	        msgSuccess.innerHTML = '<strong>Até mais, espero te ver de novo!</strong>';
			setTimeout(() => {
		        window.location.href = `index.html`;
		    }, 1000);
		}

	</script>
  </body>
</html> 